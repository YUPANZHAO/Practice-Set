# 牛妹吃豆子

链接：https://ac.nowcoder.com/acm/contest/5158/D

来源：牛客网

## 题目描述

牛妹为了打比赛经常不吃饭，但是牛妹非常喜欢吃豆子，她经常会吃很多很多的豆子，所以牛妹不会感觉到饿， 自然就不想吃饭了。

现在牛妹有一个 n∗m 个格子的棋盘.左下角的格子坐标为 (1,1)， 右上角的格子坐标为 (n,m).棋盘的每个格子都能放任意个豆子。

这时牛可乐带着一袋豆子走了过来， 打算跟牛妹分享这些豆子， 但是牛可乐并不想就这么简单的让牛妹吃到豆子， 所以牛可乐给牛妹出了一个难题。

现在牛可乐有 k 次操作，每次操作给出四个数字 x1,y1,x2,y2: 表示牛可乐会将所有满足 x1≤x≤x2,y1≤y≤y2 这两个条件的位置上放一个豆子。

牛可乐放完豆子后给出了 q 次询问， 每次询问给出四个数字 x1,y1,x2,y2: 表示询问所有满足 x1≤x≤x2,y1≤y≤y2 这两个条件的位置上中总共有多少个豆子。

这个问题可难住牛妹了， 牛妹想要吃到豆子就必须答对牛可乐的所有询问。

## 输入描述

输入一行四个数字 n,m,k,q

n,m 表示棋盘的大小.有 k 次操作和 q 次询问

下面 kkk 行,每行四个数字 x1,y1,x2,y2

表示牛可乐会将所有满足 x1≤x≤x2,y1≤y≤y2 这两个条件的位置上放一个豆子。

下面 q 行,每行四个数字 x1,y1,x2,y2

表示询问所有满足 x1≤x≤x2,y1≤y≤y2 这两个条件的位置上中总共有多少个豆子。

## 输出描述

每次询问，输出一行一个数字表示答案。

## input

```
2 2 1 1
1 1 2 2
1 1 2 1
```

## output

```
2
```

## 备注

1≤n,m≤2000

1≤k,q≤200000

1≤x1≤x2≤n,1≤y1≤y2≤m

n,m,k,q,x1,y1,x2,y2均是整数

## 题解

二维差分:https://www.cnblogs.com/LMCC1108/p/10753451.html

二维前缀和:https://www.cnblogs.com/hulean/p/10824752.html

对k次操作进行二维差分，然后求出K次操作后的矩阵

求出该矩阵的二维前缀和

最后O(1) 查询

## Code

``` cpp
#include<iostream>
using namespace std;

typedef long long ll;
const int N = 2005;
int n, m, k, q;
ll a[N][N];

int main(){
    ios::sync_with_stdio(false);
    cin >> n >> m >> k >> q;
    int x1, x2, y1, y2;
    for(int i=0; i < k; i++){ //二维差分
        cin >> x1 >> y1 >> x2 >> y2;
        a[x1][y1] += 1;
        a[x1][y2+1] -= 1;
        a[x2+1][y1] -= 1;
        a[x2+1][y2+1] += 1;
    }
    for(int i=1; i <= n; i++) //求出k次操作后的矩阵
        for(int j=1; j <= m; j++){
            a[i][j] = a[i][j] + a[i-1][j] + a[i][j-1] - a[i-1][j-1];
        }
    for(int i=1; i <= n; i++) //求二维前缀和
        for(int j=1; j <= m; j++){
            a[i][j] = a[i][j] + a[i-1][j] + a[i][j-1] - a[i-1][j-1];
        }
    for(int i=0; i < q; i++){ //查询
        cin >> x1 >> y1 >> x2 >> y2;
        ll ans = 0;
        ans = a[x2][y2] - a[x2][y1-1] - a[x1-1][y2] + a[x1-1][y1-1];
        cout << ans << endl;
    }
}
```

